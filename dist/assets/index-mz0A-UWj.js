(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();document.getElementById("fileInput").addEventListener("change",y,!1);function y(e){const c=e.target.files[0];if(c){const o=new FileReader;o.onload=function(a){document.getElementById("loading").style.display="block",document.getElementById("error").style.display="none",JSZip.loadAsync(a.target.result).then(t=>E(t)).catch(t=>{document.getElementById("error").textContent="Ошибка загрузки архива",document.getElementById("error").style.display="block",document.getElementById("loading").style.display="none"})},o.readAsArrayBuffer(c)}}async function E(e){const c=e.file(/\.txt$/)[0],o=e.file(/\.jpg$|\.png$/),a=e.file(/\.pdf$/),t=e.file(/\.opus$/);if(c){const m=(await c.async("text")).split(`
`),p=document.getElementById("chat");p.innerHTML="";const r=new Set;m.forEach(f=>{if(f.trim()){const n=g(f);n&&r.add(n.sender)}});const[u,h]=Array.from(r);m.forEach(f=>{if(f.trim()){const n=g(f);if(n){const l=b(n,u,h,o,a,t);p.appendChild(l)}}})}document.getElementById("loading").style.display="none"}function g(e){const c=/^(\d{2}\.\d{2}\.\d{4}, \d{2}:\d{2}) - (.*?): (.*)$/,o=e.match(c);if(!o)return null;const a=o[1],t=o[2].trim(),i=o[3].trim();return{timestamp:a,sender:t,message:i}}function b(e,c,o,a,t,i){const m=document.createElement("div");m.className="message "+(e.sender===c?"sent":"received");const p=document.createElement("div");p.className="sender",p.textContent=e.sender;const r=document.createElement("div");r.className="content";const u=e.message.match(/\b(\S+\.(jpg|png))\b/i);if(u){const n=u[0],l=a.find(s=>s.name===n);l&&l.async("base64").then(s=>{const d=document.createElement("img");d.src=`data:image/${n.split(".").pop()};base64,${s}`,d.className="clickable-image",d.onclick=()=>C(d.src),r.appendChild(d)}),e.message=e.message.replace(n,"").trim()}const h=e.message.match(/\b(\S+\.pdf)\b/i);if(h){const n=h[0],l=t.find(s=>s.name===n);if(l){const s=document.createElement("a");s.href="#",s.className="file-link",s.textContent=n,s.onclick=()=>x(l),r.appendChild(s)}e.message=e.message.replace(n,"").trim()}const f=e.message.match(/\b(\S+\.opus)\b/i);if(f){const n=f[0],l=i.find(s=>s.name===n);l&&l.async("blob").then(s=>{const d=document.createElement("audio");d.controls=!0,d.src=URL.createObjectURL(s),r.appendChild(d)}),e.message=e.message.replace(n,"").trim()}if(e.message.includes("(файл добавлен)")){const n=document.createElement("a");n.href="#",n.className="file-link",n.textContent=e.message.replace("(файл добавлен)","").trim(),r.appendChild(n)}else{const n=/https?:\/\/[^\s]+/g,l=e.message.split(n);let s;for(r.appendChild(document.createTextNode(l.shift()));s=n.exec(e.message);){const d=document.createElement("a");d.href=s[0],d.className="link",d.textContent=s[0],d.target="_blank",r.appendChild(d),r.appendChild(document.createTextNode(l.shift()))}}return m.appendChild(p),m.appendChild(r),m}function C(e){const c=document.createElement("div");c.className="modal";const o=document.createElement("div");o.className="modal-content";const a=document.createElement("img");a.src=e,o.appendChild(a);const t=document.createElement("span");t.className="close",t.textContent="×",t.onclick=()=>N(c),o.appendChild(t),c.appendChild(o),document.body.appendChild(c)}function N(e){document.body.removeChild(e)}function x(e){e.async("blob").then(c=>{const o=URL.createObjectURL(c),a=document.createElement("a");a.href=o,a.download=e.name,a.click(),URL.revokeObjectURL(o)})}
